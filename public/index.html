<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="ie=edge"><title>Houdini Gameboy PaintWorklet</title><link rel="stylesheet" href="/index.21af339f.css"><script defer data-domain="css-houdini-gameboy.vercel.app" src="https://plausible.io/js/plausible.js"></script><meta name="title" content="CSS Houdini GameBoy PaintWorklet"><meta name="description" content="A super dumb Houdini PaintWorklet."><meta property="og:type" content="website"><meta property="og:url" content="https://css-houdini-gameboy.vercel.app/"><meta property="og:title" content="CSS Houdini GameBoy PaintWorklet"><meta property="og:description" content="A super dumb Houdini PaintWorklet."><meta property="og:image" content="https://css-houdini-gameboy.vercel.app/og.jpg"><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://metatags.io/"><meta property="twitter:title" content="CSS Houdini GameBoy PaintWorklet"><meta property="twitter:description" content="A super dumb Houdini PaintWorklet."><meta property="twitter:image" content="https://css-houdini-gameboy.vercel.app/og.jpg"></head><body> <div id="content"> <h1>Experimental Houdini Gameboy PaintWorklet</h1> <h2 class="author"> by <a href="https://broddin.be/english">Tim Broddin</a> </h2> <div class="css-houdini-gameboy"></div> <p class="center"> WIP. <strong>Buggy</strong> as hell. Unplayable. Controllable with your keyboard: left, right, up, down, a, b, space (start), enter (select) </p> <h2>What's a PaintWorklet (Houdini)?</h2> <p> <cite>The CSS Painting API — part of the CSS Houdini umbrella of APIs — allows developers to write JavaScript functions that can draw directly into an element's background, border, or content.</cite> - <a href="https://developer.mozilla.org/en-US/docs/Web/API/CSS_Painting_API">MDN</a> </p> <p> Paint worklets are registered using Javascript, and can be used in CSS with a <code>paint()</code> call. </p> <p> <code> <pre>
&lt;script&gt;
    CSS.paintWorklet.addModule("gameboy.js");
&lt;/script&gt;

&lt;style&gt;
    .css-houdini-gameboy {
        background: paint(gameboy);
    }
&lt;/style&gt;
      </pre> </code> </p> <p> The Painting API provides a (limited) canvas-like API to draw. When the element using the <code>paint()</code> function is redrawn, the worklets' paint method is called. </p> <h2>How does this work?</h2> <p> The PaintWorklet loads <a href="https://www.npmjs.com/package/serverboy">Serverboy</a>, a Gameboy emulator tailored for headless use and starts a ROM (inlined in the bundled code). </p> <p> Redraws are triggered by animating a custom CSS variable called <code>--frame</code>. You could do this in CSS, but it's easier to control the frame rate in JS. </p> <p> Controls are also implemented as CSS variables, for example this would make Mario jump all the time: </p> <p> <code> <pre>
&lt;div class="css-houdini-gameboy" style="--button-a: 1"&gt;&lt;/div&gt;
          </pre> </code> </p> <p> By triggering the right CSS variables at the right time, you can control Mario. </p> <h2>Caveats</h2> <ul> <li>There's serious stutter. Sometimes old frames get redrawn.</li> <li>Slow as hell</li> <li> Since there's no <code>putImageData</code> function in the limited Paint API, all pixel data is looped & 96K rectangles are drawn. </li> </ul> <h2>Code</h2> <p> I wont be working on this <strong>dumb experiment</strong> actively, but if for some reason you need a Gameboy emulator inside a Paint Worklet, feel free to grab <a href="https://github.com/TimBroddin/css-houdini-gameboy">my code</a>. </p> </div> <script type="module">var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},e={},r={},o=t.parcelRequire18a3;null==o&&((o=function(t){if(t in e)return e[t].exports;if(t in r){var o=r[t];delete r[t];var n={id:t,exports:{}};return e[t]=n,o.call(n.exports,n,n.exports),n.exports}var s=new Error("Cannot find module '"+t+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(t,e){r[t]=e},t.parcelRequire18a3=o),o.register("iRC4O",(function(t,e){t.exports=import("./css-paint-polyfill.97aea7f6.js").then((()=>o("cxfES")))}));var n;o.register("kPq84",(function(t,e){var r,o,n,s,y;r=t.exports,o="getBundleURL",n=()=>y,s=t=>y=t,Object.defineProperty(r,o,{get:n,set:s,enumerable:!0,configurable:!0});var l={};function u(t){return(""+t).replace(/^((?:https?|file|ftp):\/\/.+)\/[^/]+$/,"$1")+"/"}y=function(t){var e=l[t];return e||(e=function(){try{throw new Error}catch(e){var t=(""+e.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(t)return u(t[2])}return"/"}(),l[t]=e),e}})),n=o("kPq84").getBundleURL("eFFlG")+"gameboy.c2ff4dfb.js",async function(){void 0===CSS.paintWorklet&&await o("iRC4O"),CSS.paintWorklet.addModule(n);const t=document.querySelector(".css-houdini-gameboy");let e=0;const r=()=>{t.style.setProperty("--frame",e),e++,requestAnimationFrame(r)};r(),document.addEventListener("keydown",(e=>{e.preventDefault(),"ArrowLeft"===e.key?t.style.setProperty("--button-left","1"):"ArrowRight"===e.key?t.style.setProperty("--button-right","1"):"ArrowUp"===e.key?t.style.setProperty("--button-up","1"):"buttonDown"===e.key?t.style.setProperty("--button-down","1"):"a"===e.key?t.style.setProperty("--button-a","1"):"b"===e.key?t.style.setProperty("--button-b","1"):" "===e.key?t.style.setProperty("--button-start","1"):"Enter"===e.key&&t.style.setProperty("--button-select","1")})),document.addEventListener("keyup",(e=>{"ArrowLeft"===e.key?t.style.setProperty("--button-left","0"):"ArrowRight"===e.key?t.style.setProperty("--button-right","0"):"ArrowUp"===e.key?t.style.setProperty("--button-up","0"):"buttonDown"===e.key?t.style.setProperty("--button-down","0"):"a"===e.key?t.style.setProperty("--button-a","0"):"b"===e.key?t.style.setProperty("--button-b","0"):" "===e.key?t.style.setProperty("--button-start","0"):"Enter"===e.key&&t.style.setProperty("--button-select","0")}))}();</script> </body></html>